---
title: "DRAFT"
author: "Alima Dzhanybaeva"
date: "2022-10-31"
output:
  pdf_document:
         latex_engine: xelatex
  html_document: default
---
```{r include=FALSE}
library(tidyverse)
library(modelsummary)
library(dplyr)
library(knitr)
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```
## 1.1 Overview of the original data.
### The original hotels-europe data includes information on price and features of hotels in 46 European cities and for 2017-2018. The data was downloaded from https://osf.io/yzntm/download.

```{r include=FALSE}
variables <- c('hotel_id','accommodation_type', 'addresscountryname', 'weekend', 'holiday',
               'center1distance', 'starrating', 'guestreviewrating', 'price', 'price_night',
               'year', 'month')
info <- c('Hotel ID', 'Type of accomodation', 'Country', 'Flag, if day is a weekend',
          'Flag, if day is a public holiday', 'Distance from main city center',
          'Number of stars', 'User rating average', 'Price in EUR', 'Number of nights',
          'Year (YYYY)', 'Month (MM)')
type <- c('numeric', 'string', 'string', 'binary', 'binary', 'string',
          'numeric', 'string', 'numeric', 'string', 'numeric', 'numeric')
description <- data.frame(variables, info, type)
```
```{r include=FALSE}
kable(description, caption = "Description of the main variables in the original dataset")
```

### • Some value are non-zero but include zeros. The next table checks the zero values and the quantity of unique values.
```{r include=FALSE}
df <- read.csv('https://osf.io/yzntm/download')
```
```{r}
kable(funModeling::df_status(df))
```

## 1.2 Dataset for 7 Central European countries
### • For our analysis we used 7 Central European countries: Czech Republic, Germany, Italy, Hungary, Austria, Poland, Slovakia.
```{r}
df2 <- df %>% filter(addresscountryname %in% 
                       c('Czech Republic', 'Germany', 'Italy', 
                         'Hungary', 'Austria', 'Poland', 'Slovakia'))

```

### • The folowing manipulations were carried out on the original data to change the existing variables and to add new ones:
* The type of the variables *center1distance* and *guestreviewsrating* were changed from 'string' to 'numeric'. The new variable names are *distance* and *actualrating * respectively.
```{r include=FALSE}
# guestreviewrating separation
df2 <- separate(df2, guestreviewsrating, ' /', into =
                 c('actualrating', 'rate'))
df2 <- select(df2, -rate)
df2$actualrating <- as.numeric(df2$actualrating)

# Distance
df2 <- separate(df2, center1distance, ' ', into =
                  c('distance', 'miles'))
df2 <- select(df2, -miles)
df2$distance <- as.numeric(df2$distance)
```
* The original *accommodationtype* variable was tranformed into new *accomtype* factor variable.
```{r}
df2 <- separate(df2, accommodationtype, '@', into = 
                 c('word', 'acctype'))
df2 <- select(df2, -word)
df2 <- mutate(df2, acctype_f = factor(acctype))
```
* *trueprice* variable was generated by dividing the original *price* variable by *price_night*
```{r}
df2 <- separate(df2, price_night, ' ', into =
                     c('pr','word', 'nights', 'night'))
df2 <- select(df2, -pr)
df2 <- select(df2, -night)
df2 <- select(df2, -word)
df2$nights <- as.numeric(df2$nights)
df2$trueprice <- df2$price/df2$nights
```
* *season* variable was created based on the *month* variable
```{r}
df2 <- df2 %>%
  mutate(season = case_when(month == 12 | month == 1 |month == 2 ~ 'winter',
                            month == 3 | month == 4 |month == 5 ~ 'spring',
                            month == 6 | month == 7 |month == 8 ~ 'summer',
                            month == 9 | month == 10 |month == 11 ~ 'autumn'))
```
* With the help of the existing *starrating* variable new *class* variable was generated
```{r}
df2 <- df2 %>%
  mutate(class = case_when(starrating == 1.0 | starrating == 1.5 ~ 'tourist',
                           starrating == 2.0 | starrating == 2.5 ~ 'standard',
                           starrating == 3.0 | starrating == 3.5 ~ 'comfort',
                           starrating == 4.0 | starrating == 4.5 ~ 'first class',
                           starrating == 5.0 ~ 'luxury'))
```

### • Quality of the dataset - missing values overview and frequency distribution of numeric values

```{r}
df2 %>% 
  skimr::skim_without_charts() 
```

## Summary for the main variables in the transformed dataset
### __Numeric variables__
```{r echo=FALSE}
datasummary(distance + starrating + actualrating + trueprice ~ Mean + Min + Max + SD, data = df2) %>%
   kableExtra::kable_styling(latex_options = "hold_position")
```

* Distance
75% of the hotels are located between 0 and 2.4 miles from the main city center. 
The histogram below shows the distribution of the distances from the city center, the limit for x-axis was set at 25 miles.
```{r echo=FALSE}
ggplot(data=df2, aes(x=distance)) + geom_histogram(fill='navyblue', color='white', bins = 35) + 
  labs(x='Distance', y='Count')
```

* Starrating
Most of hotels from the dataset have 3 and 4 stars.
```{r echo=FALSE}
ggplot(data=df2, aes(x=starrating)) + geom_histogram(fill='navyblue', color='white', bins = 35) + 
  labs(x='Stars', y='Count') + xlim(1,5)
```

* Actualrating
As we can see from the histogram below, 80% of the guest reviews are between 3.4 and 4.1.
```{r echo=FASLE, message=FALSE}
ggplot(data=df2, aes(x=actualrating)) + geom_histogram(fill='navyblue', color='white') + 
  labs(x='Guest reviews', y='Count')
```

* Trueprice
99% of the prices are below 600 EUR, thus, the limit for x-axis in histogram was set to this value.
The distribution of the prices is skewed to the right, therefore, we can conclude that the mean price is greater then the mode.
```{r echo=FALSE, message=FALSE}
ggplot(data=df2, aes(x=trueprice)) + geom_histogram(fill='navyblue', color='white') + 
  labs(x='Price', y='Count') + xlim(0, 1200) 
```
* Year and month
```{r echo=FALSE}
kable(count(df2, year))
```
```{r echo=FALSE}
kable(count(df2, month))
```
### • Accommodation type
```{r echo=FALSE}
kable(count(df2,acctype_f) %>% arrange(desc(n)))
```

### • Country
```{r echo=FALSE}
kable(count(df2, addresscountryname) %>% arrange(desc(n)))
```

### • Weekend and holiday
```{r echo=FALSE}
kable(count(df2, weekend))
```
```{r echo=FALSE}
kable(count(df2, holiday))
```

### • Season and class
```{r echo=FALSE}
kable(count(df2, season) %>% arrange(desc(n)))
```
```{r echo=FALSE}
kable(count(df2, class))
```

## Findings
### • Mean prices for countries
```{r}
datasummary(trueprice*addresscountryname ~ Mean + Max + Min, data=df2)
```

### • Ratings for diff countries
```{r}
datasummary(actualrating*addresscountryname ~ Mean, data=df2)
```

### • Plot for diff years diff countries
```{r}
df3 <- aggregate(trueprice ~ addresscountryname + year, 
                 data=df2, 
                 function(x) { 
                   c(mean_price = mean(x)) 
                 })
ggplot(data = df3, aes(x=year, y=trueprice, fill=addresscountryname)) + 
  geom_bar(stat='identity') + facet_wrap(~addresscountryname) +
  geom_text(aes(label = round(trueprice)), vjust = -0.2)
```

### • Mean prices for diff seasons
```{r}
datasummary(trueprice*season ~ Mean, data=df2) %>%
   kableExtra::kable_styling(latex_options = "hold_position")
```

### • Plot for classes
```{r message=FALSE}
datasummary(trueprice*class ~ Mean, data = df2) %>%
   kableExtra::kable_styling(latex_options = "hold_position")
ggplot(data = df2, aes(x=reorder(class, +trueprice), y=trueprice, fill = class)) + 
  geom_bar(stat = 'summary') + labs(x='Class', y='Price', fill = 'Class')
```
